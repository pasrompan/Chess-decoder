# Jira Integration Guide

This guide explains how to sync issues between the local AI PM system and Jira.

## Overview

The AI PM system integrates with Jira project **PG** under Epic **ChessScriber** at `https://paschalis-rompanos.atlassian.net/`.

## Prerequisites

1. **Atlassian MCP Server**: Must be configured and accessible
2. **Jira Access**: Access to project PG and Epic ChessScriber
3. **Cloud ID**: Jira Cloud ID for API operations

## Configuration

### Getting Your Cloud ID

The Cloud ID is required for Jira API operations. You can:

1. Get it from the Atlassian MCP server using `getAccessibleAtlassianResources`
2. Extract it from Jira URLs
3. Set it as an environment variable: `export JIRA_CLOUD_ID="your-cloud-id"`

### Project Settings

The system is configured for:
- **Project**: PG
- **Epic**: ChessScriber
- **Instance**: https://paschalis-rompanos.atlassian.net/

These are set in `scripts/sync-jira.sh`.

## Sync Operations

### Sync to Jira (Local → Jira)

Creates or updates Jira issues from local markdown files:

```bash
./ai-pm/scripts/sync-jira.sh to-jira
```

**What it does**:
- Creates new Jira issues for issues without `jira_key`
- Updates existing Jira issues for issues with `jira_key`
- Maps local issue metadata to Jira fields:
  - Title → Summary
  - Description → Description
  - Impact/Effort → Custom fields (if configured)
  - Status → Jira status

### Sync from Jira (Jira → Local)

Pulls Jira issues and creates/updates local markdown files:

```bash
./ai-pm/scripts/sync-jira.sh from-jira
```

**What it does**:
- Fetches issues from Jira project PG, Epic ChessScriber
- Creates local markdown files for new issues
- Updates existing local files with Jira data
- Preserves local metadata not in Jira

### Bidirectional Sync

Syncs both directions:

```bash
./ai-pm/scripts/sync-jira.sh both
```

## Issue Mapping

### Local → Jira

| Local Field | Jira Field | Notes |
|------------|------------|-------|
| `id` | Issue Key | Generated by Jira (PG-XXX) |
| Title | Summary | First `# Title` in markdown |
| Description | Description | Content under `## Description` |
| `impact` | Custom Field | If configured in Jira |
| `effort` | Story Points | If configured |
| `status` | Status | Mapped to Jira status |
| `dependencies` | Links | Creates "depends on" links |

### Jira → Local

| Jira Field | Local Field | Notes |
|------------|-------------|-------|
| Issue Key | `jira_key` | Stored in frontmatter |
| Summary | Title | First `# Title` |
| Description | Description | Under `## Description` |
| Status | `status` | Mapped from Jira status |
| Story Points | `effort` | If available |
| Links | `dependencies` | Parsed from "depends on" links |

## Using MCP Server

The sync script provides a framework, but actual Jira operations use the Atlassian MCP server.

### Create Jira Issue

```bash
# The script will show the MCP command needed
# Example:
mcp_Atlassian-MCP-Server_createJiraIssue \
  --cloudId "your-cloud-id" \
  --projectKey "PG" \
  --issueTypeName "Task" \
  --summary "Issue Title" \
  --description "Issue description"
```

### Update Jira Issue

```bash
mcp_Atlassian-MCP-Server_editJiraIssue \
  --cloudId "your-cloud-id" \
  --issueIdOrKey "PG-123" \
  --fields '{"summary": "Updated Title"}'
```

### Fetch Jira Issue

```bash
mcp_Atlassian-MCP-Server_getJiraIssue \
  --cloudId "your-cloud-id" \
  --issueIdOrKey "PG-123"
```

### Search Jira Issues

```bash
mcp_Atlassian-MCP-Server_searchJiraIssuesUsingJql \
  --cloudId "your-cloud-id" \
  --jql "project = PG AND 'Epic Link' = ChessScriber"
```

## Workflow

### Initial Setup

1. **Get Cloud ID**: Use MCP to get accessible resources
2. **Set Environment**: `export JIRA_CLOUD_ID="your-cloud-id"`
3. **Test Connection**: Run sync script to verify access

### Daily Workflow

1. **Create Local Issue**: Create markdown file in `issues/active/`
2. **Sync to Jira**: Run `sync-jira.sh to-jira` to create Jira issue
3. **Work in Jira**: Update issue in Jira as needed
4. **Sync from Jira**: Run `sync-jira.sh from-jira` to pull updates
5. **Commit**: Git hook updates priorities automatically

### Issue Lifecycle

1. **Created Locally**: Issue created in `issues/active/ISSUE-XXX.md`
2. **Synced to Jira**: Creates PG-XXX in Jira
3. **Updated in Jira**: Status, comments, etc. updated in Jira
4. **Synced Back**: Local file updated with Jira data
5. **Completed**: Issue moved to `archive/completed/`, Jira issue closed

## Status Mapping

| Local Status | Jira Status | Notes |
|-------------|-------------|-------|
| `active` | To Do / In Progress | Active work |
| `completed` | Done | Finished work |
| `deprioritized` | Backlog | No longer priority |

## Field Mapping Details

### Impact and Effort

These local fields can be mapped to Jira custom fields or story points:

- **Impact**: Map to custom field "Impact" or "Business Value"
- **Effort**: Map to "Story Points" or "Original Estimate"

### Dependencies

Dependencies are handled via Jira issue links:

- Local `dependencies: [ISSUE-001]` → Jira "depends on" link to PG-XXX
- Jira "depends on" links → Local `dependencies` array

## Troubleshooting

### Cloud ID Not Found

**Error**: `Jira Cloud ID not configured`

**Solution**:
1. Get Cloud ID from MCP: `getAccessibleAtlassianResources`
2. Set environment variable: `export JIRA_CLOUD_ID="your-id"`
3. Or update script with hardcoded value (not recommended)

### MCP Server Not Available

**Error**: MCP operations fail

**Solution**:
1. Verify MCP server is configured in Cursor
2. Check `.cursor/rules/chesscoderrules.mdc` for configuration
3. Test MCP connection manually

### Sync Conflicts

**Issue**: Local and Jira versions differ

**Solution**:
1. Review differences manually
2. Choose source of truth (usually Jira for status, local for technical details)
3. Manually merge if needed
4. Re-sync after resolving

### Missing Epic Link

**Error**: Issues not found in Epic

**Solution**:
1. Verify Epic name is "ChessScriber" in Jira
2. Check JQL query in sync script
3. Manually link issues to Epic in Jira if needed

## Best Practices

1. **Sync Regularly**: Sync before and after major work sessions
2. **Source of Truth**: Decide whether Jira or local is primary
3. **Keep Metadata**: Don't overwrite local technical notes when syncing
4. **Review Mappings**: Verify field mappings match your Jira configuration
5. **Test First**: Test sync on a single issue before bulk operations

## Automation

### Git Hook Integration

You can extend the pre-commit hook to sync with Jira:

```bash
# In pre-commit hook, after prioritization
if [ -n "$SYNC_JIRA_ON_COMMIT" ]; then
    ./ai-pm/scripts/sync-jira.sh to-jira
fi
```

### Scheduled Sync

Set up a cron job or GitHub Action to sync periodically:

```bash
# Daily sync at 9 AM
0 9 * * * cd /path/to/repo && ./ai-pm/scripts/sync-jira.sh both
```

## Advanced Configuration

### Custom Field Mapping

Edit `sync-jira.sh` to map custom fields:

```bash
# Map impact to custom field
IMPACT_FIELD_ID="customfield_12345"

# Map effort to story points
EFFORT_FIELD="story_points"
```

### Status Workflow

Configure status transitions in the script to match your Jira workflow:

```bash
# Status mapping
declare -A STATUS_MAP=(
    ["active"]="In Progress"
    ["completed"]="Done"
    ["deprioritized"]="Backlog"
)
```

## Support

For issues with Jira integration:
1. Check MCP server logs
2. Verify Jira permissions
3. Review Jira API documentation
4. Test with MCP tools directly

